<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIãƒ¬ãƒãƒ¼ãƒˆãƒ»èª­æ›¸æ„Ÿæƒ³æ–‡ä½œæˆãƒãƒ£ãƒƒãƒˆ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="app-container">
        
        <div id="mode-selector">
            <label>
                <input type="radio" name="creation_mode" value="general_report" checked>
                ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ ğŸ“„
            </label>
            <label>
                <input type="radio" name="creation_mode" value="book_report">
                èª­æ›¸æ„Ÿæƒ³æ–‡ä½œæˆ ğŸ“š
            </label>
        </div>
        
        <div id="chat-area" data-mode="general_report">
            <div id="chat-history">
                <div class="ai-message">
                    ã“ã‚“ã«ã¡ã¯ï¼ãƒ¬ãƒãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚<br>
                    ãƒ†ãƒ¼ãƒã‚„æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>
            
            <div id="input-area">
                
                <div id="attached-files">
                    </div>

                <textarea id="user-input" placeholder="è³ªå•ã‚„æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
                
                <div id="file-upload-container">
                    <input type="file" id="file-input" style="display: none;" multiple>
                    
                    <button id="upload-button" title="ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ">
                        +
                    </button>
                    <span id="file-hint" style="font-size: 0.8em; margin-left: 10px; color: #666;">
                        (ç”»åƒ, PDF/EPUB, TXT)
                    </span>
                </div>

                <button id="send-button" title="é€ä¿¡">
                    &#x25B2; 
                </button>
            </div>
        </div>

        <div id="report-area">
            <div id="report-display">
                <p>ã“ã“ã«ãƒ¬ãƒãƒ¼ãƒˆã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
            </div>
            
            <div id="report-footer">
                <div id="download-box">
                    <span id="report-filename">ãƒ¬ãƒãƒ¼ãƒˆ.txt</span>
                    <button id="download-button">download</button>
                </div>
                <div id="char-count">0 æ–‡å­—</div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modeRadios = document.querySelectorAll('input[name="creation_mode"]');
            const chatArea = document.getElementById('chat-area');
            const fileInput = document.getElementById('file-input');
            const fileHint = document.getElementById('file-hint');
            const reportFilename = document.getElementById('report-filename');
            const chatHistory = document.getElementById('chat-history');

            // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
            function handleModeChange(event) {
                const mode = event.target.value;
                chatArea.setAttribute('data-mode', mode);
                
                // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã®è¨±å¯ã‚¿ã‚¤ãƒ—ã‚’åˆ‡ã‚Šæ›¿ãˆ
                if (mode === 'book_report') {
                    // èª­æ›¸æ„Ÿæƒ³æ–‡ãƒ¢ãƒ¼ãƒ‰: æ›¸ç±ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¨±å¯
                    fileInput.accept = '.pdf, .epub, .txt';
                    fileInput.removeAttribute('multiple');
                    fileHint.textContent = '(PDF, EPUB, TXTãƒ•ã‚¡ã‚¤ãƒ«ã‚’1ã¤)';
                    reportFilename.textContent = 'æ„Ÿæƒ³æ–‡.txt';
                    
                    // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ  (åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
                    chatHistory.innerHTML += `<div class="ai-message">èª­æ›¸æ„Ÿæƒ³æ–‡ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸã€‚æ›¸ç±ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€æ„Ÿæƒ³æ–‡ã®è¦ä»¶ã‚’æŒ‡ç¤ºã—ã¦ãã ã•ã„ã€‚</div>`;
                } else {
                    // ãƒ¬ãƒãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ‰: ç”»åƒã‚’è¨±å¯
                    fileInput.accept = 'image/*';
                    fileInput.setAttribute('multiple', '');
                    fileHint.textContent = '(ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°)';
                    reportFilename.textContent = 'ãƒ¬ãƒãƒ¼ãƒˆ.txt';

                    // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ  (åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)
                    chatHistory.innerHTML += `<div class="ai-message">ãƒ¬ãƒãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸã€‚ãƒ†ãƒ¼ãƒã‚„æŒ‡ç¤ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>`;
                }
                
                // ã“ã“ã§ç¾åœ¨ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢ã™ã‚‹å‡¦ç†ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ’ä»–åˆ©ç”¨ã®ãŸã‚ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚
                // ä¾‹: clearAttachedFiles(); (åˆ¥é€”å®šç¾©ãŒå¿…è¦)
            }

            modeRadios.forEach(radio => {
                radio.addEventListener('change', handleModeChange);
            });
            
            // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ä¸€åº¦å®Ÿè¡Œ (åˆæœŸçŠ¶æ…‹ã®è¨­å®š)
            document.querySelector('input[name="creation_mode"]:checked').dispatchEvent(new Event('change'));

            // æ³¨æ„: #upload-button, #send-button, #file-input ã®å®Ÿéš›ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã€APIé€£æºï¼‰ã¯
            // script.js ã§å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä¸Šè¨˜ã§ãƒ¢ãƒ¼ãƒ‰æƒ…å ±ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã¯HTMLã¨é€£å‹•ã—ã¾ã—ãŸã€‚
        });
    </script>
</body>
</html>
